{{- if .Values.otel_collector.enabled }}
# allow otel-collector to read namespaces, pods and replicasets (required for k8sattributes processor)
# and to write traces to default-tenant
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: openshift-observability-otel-collector
rules:
- apiGroups: [""]
  resources: ["namespaces", "pods"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["replicasets"]
  verbs: ["get", "list", "watch"]
- apiGroups: [tempo.grafana.com]
  resourceNames: [traces]
  verbs: [create]
  resources: [default-tenant]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: openshift-observability-otel-collector
roleRef:
  kind: ClusterRole
  name: openshift-observability-otel-collector
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: otel-collector
  namespace: openshift-observability
{{- end }}
