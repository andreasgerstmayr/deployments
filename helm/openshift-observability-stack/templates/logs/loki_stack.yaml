{{- if .Values.logs.enabled }}
apiVersion: loki.grafana.com/v1
kind: LokiStack
metadata:
  name: logging-loki
  namespace: openshift-logging
spec:
  managementState: Managed
  size: {{ .Values.logs.size }}
  storage:
    schemas:
    - effectiveDate: '2022-06-01'
      version: v13
    secret:
      name: logging-loki-s3
      type: s3
  storageClassName: gp3-csi
  tenants:
    mode: openshift-logging
---
apiVersion: v1
kind: Secret
metadata:
  name: logging-loki-s3
  namespace: openshift-logging
stringData:
  endpoint: {{ .Values.storage.s3.endpoint }}
  bucketnames: {{ .Values.logs.storage.s3.bucket }}
  access_key_id: {{ .Values.storage.s3.access_key_id }}
  access_key_secret: {{ .Values.storage.s3.access_key_secret }}
type: Opaque
{{- end }}
